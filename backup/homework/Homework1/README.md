# Домашнее задание - разделить учебный docker-compose.yml на два

## Дано:

На занятии мы описали в конфиге нужные `act-device-api` сервисы: базу данных `postgres`, ещё там есть `nginx`, `swagger-ui` и сервис для сохранения трейсов.
Мы собрали и запустили приложение, и увидели, что оно проходит live-check.

Сейчас вся связка сервисов настроена у нас в одном `docker-compose.yml`.
Для целей разработки нам может понадобиться запустить наш сервис не внутри контейнера - а при помощи `make run` или из IDE.
При этому у него должен быть доступ к `postgres`/`kafka`.

## Задание:

- Разделите docker-compose.yml на 2 файла:
  - `docker-compose.service.yaml` - конфиг с запуском `act-device-api`, `swagger` и `nginx`.
  - `docker-compose.service-env.yaml` - конфиг с запуском БД (`postgres`, `Kafka`), `jaeger` и всего остального
- В makefile надо:
  - поправить команду для поднятия `act-device-api` и всех необходимых ему сервисов [`dc-up` и `dc-rebuild-reup`]
    - запускать связки сервисов из двух раздельных конфигов
  - поправить команду для "выключения" `act-device-api` и всех необходимых ему сервисов [`dc-down` и `dc-stop`]
    - "выключать" связки сервисов из двух раздельных конфигов
  - добавить команду для запуска отдельно только сервисов из `docker-compose.service-env.yaml`
  - добавить команду для "выключения" только сервисов из `docker-compose.service-env.yaml`
- Проверьте, что все по-прежнему работает после запуска из раздельных конфигов - livecheck, ручки в `swagger`
- Проверьте, что можно запустить, выключить и снова запустить сервисы вашими make командами.

## Критерии приемки задания:

- два `docker-compose.*.yml` в коммите
- изменения в Makefile в коммите
- вывод `docker-compose ps` в описании MR после запуска сервисов

## Подсказки:

1976 год - создана утилита make. Даже сейчас она активно используется в разработке. С её помощью можно сохранять алиасы сложных команд вместе с кодом репозитория (хотя это и не совсем использование по-назначению, в первую очередь это инструмент сборки).

В качестве разделитей используются табы. Stuart Feldman утверждает, [что это обратная совместимость](http://catb.org/~esr/writings/taoup/html/ch15s04.html).

Синтаксис Makefile прост, вот шпаргалка по формату одного из существующих rule:

```
.PHONY: dc-rebuild-reup   <- нужно собирать всегда, потому что это не файл
dc-rebuild-reup: dc-down  <- название target, запускаем как make dc-rebuild-reup. Перед этой командой выполнится dc-down.
	docker-compose -p ozon_route256 up --build --force-recreate -V -d # эту команду выполнит make
```

Посмотреть список контейнеров:

```bash
# только активные контейнеры
docker ps
# все контейнеры (и активные и упавшие)
docker ps -a
```

Посмотреть список сетей docker:

```bash
docker network ls
```

Посмотреть список образов docker:

```bash
docker images
```
